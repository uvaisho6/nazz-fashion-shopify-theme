<div class="product-card {% if sold_out %}sold-out{% endif %}" data-product-id="{{ product.id }}">
    <div class="product-image">
        <img src="{{ product.featured_image | img_url: '300x400', crop: 'center' }}" 
             alt="{{ product.featured_image.alt | escape }}"
             loading="lazy"
             width="300"
             height="400">
        
        {% if product.compare_at_price > product.price %}
            <span class="badge sale">Sale</span>
        {% endif %}
        
        {% if product.tags contains 'new' %}
            <span class="badge new">New</span>
        {% endif %}
        
        {% if product.tags contains 'trending' %}
            <span class="badge trending">Trending</span>
        {% endif %}

        <div class="quick-view">
            <button class="btn quick-view-btn" data-quick-view="{{ product.id }}">
                Quick View
            </button>
        </div>
    </div>

    <div class="product-info">
        <h3 class="product-title">
            <a href="{{ product.url }}">{{ product.title }}</a>
        </h3>

        <div class="product-price">
            {% if product.compare_at_price > product.price %}
                <span class="regular-price">{{ product.compare_at_price | money }}</span>
            {% endif %}
            <span class="current-price{% if product.compare_at_price > product.price %} sale{% endif %}">
                {{ product.price | money }}
            </span>
        </div>

        {% if product.variants.size > 1 %}
            <select name="id" class="product-variant-select">
                {% for variant in product.variants %}
                    <option value="{{ variant.id }}"
                            {% if variant == product.selected_or_first_available_variant %}selected="selected"{% endif %}
                            {% unless variant.available %}disabled{% endunless %}>
                        {{ variant.title }}
                    </option>
                {% endfor %}
            </select>
        {% endif %}

        <button class="btn primary add-to-cart"
                {% unless product.available %}disabled{% endunless %}
                data-product-id="{{ product.id }}"
                data-variant-id="{{ product.selected_or_first_available_variant.id }}">
            {% if product.available %}
                Add to Cart
            {% else %}
                Sold Out
            {% endif %}
        </button>

        {% if section.settings.show_wishlist %}
            <button class="btn wishlist-btn" data-product-id="{{ product.id }}">
                <i class="far fa-heart"></i>
            </button>
        {% endif %}
    </div>
</div>

{% schema %}
{
    "name": "Product Card",
    "settings": [
        {
            "type": "checkbox",
            "id": "show_wishlist",
            "label": "Show Wishlist Button",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "show_quick_view",
            "label": "Show Quick View",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "show_sale_badge",
            "label": "Show Sale Badge",
            "default": true
        }
    ]
}
{% endschema %}

<style>
.product-card {
    position: relative;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.product-image {
    position: relative;
    overflow: hidden;
    padding-top: 133.33%; /* 4:3 aspect ratio */
}

.product-image img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
}

.product-card:hover .product-image img {
    transform: scale(1.05);
}

.badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
    z-index: 2;
}

.badge.sale {
    background: var(--secondary-color);
    color: white;
}

.badge.new {
    background: var(--accent-color);
    color: white;
}

.badge.trending {
    background: var(--primary-color);
    color: white;
}

.quick-view {
    position: absolute;
    bottom: -50px;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.7);
    padding: 0.8rem;
    transition: bottom 0.3s;
    text-align: center;
}

.product-card:hover .quick-view {
    bottom: 0;
}

.quick-view-btn {
    background: transparent;
    color: white;
    border: 1px solid white;
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: background 0.3s;
}

.quick-view-btn:hover {
    background: white;
    color: var(--primary-color);
}

.product-info {
    padding: 1rem;
    text-align: center;
}

.product-title {
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.product-title a {
    color: var(--text-color);
    text-decoration: none;
    transition: color 0.3s;
}

.product-title a:hover {
    color: var(--accent-color);
}

.product-price {
    margin-bottom: 1rem;
}

.regular-price {
    text-decoration: line-through;
    color: #999;
    margin-right: 0.5rem;
}

.current-price.sale {
    color: var(--secondary-color);
}

.product-variant-select {
    width: 100%;
    margin-bottom: 1rem;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.wishlist-btn {
    background: transparent;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    padding: 0.5rem;
    margin-left: 0.5rem;
    transition: color 0.3s;
}

.wishlist-btn:hover {
    color: var(--secondary-color);
}

.product-card.sold-out .product-image::after {
    content: 'Sold Out';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 1rem 2rem;
    border-radius: 4px;
}

button:disabled {
    background: #ccc !important;
    cursor: not-allowed;
}

@media (max-width: 768px) {
    .product-card {
        margin-bottom: 1rem;
    }
    
    .quick-view {
        display: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Quick View functionality
    document.querySelectorAll('[data-quick-view]').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.dataset.quickView;
            // Implement your quick view modal here
        });
    });

    // Variant Selection
    document.querySelectorAll('.product-variant-select').forEach(select => {
        select.addEventListener('change', function() {
            const addToCartBtn = this.closest('.product-card').querySelector('.add-to-cart');
            addToCartBtn.dataset.variantId = this.value;
        });
    });

    // Add to Cart functionality
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.dataset.productId;
            const variantId = this.dataset.variantId;
            
            fetch('/cart/add.js', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    items: [{
                        id: variantId,
                        quantity: 1
                    }]
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    console.error('Error:', data.description);
                    return;
                }
                // Update cart count
                const cartCount = document.querySelector('.cart-count');
                if (cartCount) {
                    cartCount.textContent = parseInt(cartCount.textContent) + 1;
                }
                // Show success notification
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = 'Added to cart!';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 2000);
            })
            .catch(error => console.error('Error:', error));
        });
    });

    // Wishlist functionality
    document.querySelectorAll('.wishlist-btn').forEach(button => {
        button.addEventListener('click', function() {
            const icon = this.querySelector('i');
            icon.classList.toggle('far');
            icon.classList.toggle('fas');
            // Implement your wishlist functionality here
        });
    });
});
</script>
